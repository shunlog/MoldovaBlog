{% extends "blog/base.html" %}

{% block content %}

    <article>
        <header>
            <h1>{% block title %}{{post.title }}{% endblock %}</h1>
            <p>
                Posted
                <time datetime="{{ post.pub_date.isoformat }}">{{ post.get_time_passed }}</time>
                {% if post.author %}
                    by <a href="{{ post.author.profile.get_absolute_url }}"> {{post.author.username}} </a>
                {% endif %}
            </p>
        </header>

        {{ post.text | linebreaks }}

    </article>

    {% if post.image_set.all %}
        <section>
            <hr />
            <header>
                <h2>Gallery</h2>
            </header>

            <div class='gallery-grid'>
                {% for img in post.image_set.all %}
                    <figure>
                        <a class="spotlight"
                           href="{{ img.file.url }}"
                           data-description="{{ img.description }}">
                            <img src="{{ img.file.url }}" alt="{{ img.alt }}">
                        </a>
                    </figure>
                {% endfor %}
            </div>

        </section>
    {% endif %}

    {% if post.location %}
        <section>
            <hr />
            <header>
                <h2>Location</h2>
                <p>You can view the location on the map.
                    For more information about this embedded map, visit
                    <a href="https://developers.google.com/maps/documentation/embed/get-started">
                        Google's documentation</a>.
                </p>
            </header>

            <iframe
                style="border:0"
                loading="lazy"
                allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"
                src="https://www.google.com/maps/embed/v1/place?key=AIzaSyCFTeAI-DV6kRHMJN_iHT2cpmJKsMjCTBw
                       &q={{ post.location | urlencode }}
                       &maptype=satellite">
            </iframe>

        </section>
    {% endif %}


    <section class="comment">
        <hr />
        <header>
            <h2>Comments</h2>
        </header>

        {% if not post.comment_set.all %}
            <p>Cricket chirp...</p>
        {% else %}
            {% for comment in post.comment_set.all %}
                <aside id="{{ comment.pk }}">
                    <div class="author">
                        {% if comment.author %}
                            <a href="{{ comment.author.profile.get_absolute_url }}">
                                {{comment.author.username}}
                            </a>
                        {% else %}
                            [deleted]
                        {% endif %}
                        posted
                        <a href="{{  comment.get_absolute_url }}">
                            <time datetime="{{ comment.pub_date.isoformat }}">{{ comment.get_time_passed }}</time>
                        </a>
                    </div>
                    <p> {{ comment.text | linebreaks }} </p>
                </aside>
            {% endfor %}
        {% endif %}

        {% if user.is_authenticated %}
            <section>
                <form method="post" action="{% url 'blog:create_comment' post.id %}">
                    {% csrf_token %}
                    <h2>Leave a comment</h2>
                    {{ comment_form }}
                    <input type="submit" value="Comment">
                </form>
            </section>
        {% endif %}

    </section>

{% endblock content %}
